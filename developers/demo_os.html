<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Demo OS Installer and OS Runtime &mdash; Open Network Install Environment  documentation</title>
    
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/onie-favicon-16x16.ico"/>
    <link rel="top" title="Open Network Install Environment  documentation" href="../index.html" />
    <link rel="up" title="For Developers" href="index.html" />
    <link rel="next" title="Demo Diagnostic OS Installer" href="demo_diag.html" />
    <link rel="prev" title="Porting Guide" href="porting.html" />
  
   

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="demo_diag.html" title="Demo Diagnostic OS Installer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="porting.html" title="Porting Guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">For Developers</a> &raquo;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
  <a href="
      ../index.html" class="logo">
  
  <img src="../_static/ONIE-logo-green-160x60.png" class="logo" />
  </a>
  <center><a href="https://github.com/opencomputeproject/onie" class="logo">
  <svg class="octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  opencomputeproject/onie</a></center>

<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design-spec/index.html">Design Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing-certification/index.html">Testing and Certification</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">For Developers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="building.html">Build Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html#source-code-description">Source Code Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Basic Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing to ONIE</a></li>
<li class="toctree-l2"><a class="reference internal" href="porting.html">Porting Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Demo OS Installer and OS Runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo_diag.html">Demo Diagnostic OS Installer</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html">Source Code Release Cycle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Demo OS Installer and OS Runtime</a><ul>
<li><a class="reference internal" href="#building-the-demo-installer">Building the Demo Installer</a></li>
<li><a class="reference internal" href="#using-the-installer-with-onie">Using the Installer with ONIE</a><ul>
<li><a class="reference internal" href="#installing-and-setting-up-an-http-server-on-your-build-host">Installing and Setting Up an HTTP Server on Your Build Host</a></li>
<li><a class="reference internal" href="#powering-on-the-network-switch">Powering on the Network Switch</a></li>
</ul>
</li>
<li><a class="reference internal" href="#demo-network-operating-system">Demo Network Operating System</a><ul>
<li><a class="reference internal" href="#re-installing-or-installing-a-different-os">Re-installing or Installing a Different OS</a></li>
<li><a class="reference internal" href="#uninstalling-to-wipe-the-machine-clean">Uninstalling to Wipe the Machine Clean</a></li>
<li><a class="reference internal" href="#rescue-boot">Rescue Boot</a></li>
<li><a class="reference internal" href="#updating-onie">Updating ONIE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#demo-source-code-layout">Demo Source Code Layout</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Home</a></li>
              
                <li><a href="index.html">For Developers</a></li>
              
              <li>Demo OS Installer and OS Runtime</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="demo-os-installer-and-os-runtime">
<span id="demo-os"></span><h1>Demo OS Installer and OS Runtime<a class="headerlink" href="#demo-os-installer-and-os-runtime" title="Permalink to this headline">¶</a></h1>
<p>The demo OS installer and runtime illustrate a number of ONIE
concepts, useful for OS vendors creating their own ONIE-compatible
installers:</p>
<ul class="simple">
<li>How to make an installer compatible with ONIE.</li>
<li>The tools and environment available to an installer at runtime.</li>
<li>How the OS can invoke ONIE services, like reinstall, uninstall
rescue, update and embed.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ONIE binary must previously be installed on the machine.
See the <code class="docutils literal"><span class="pre">INSTALL</span></code> file for details.</p>
</div>
<div class="section" id="building-the-demo-installer">
<span id="demo-building"></span><h2>Building the Demo Installer<a class="headerlink" href="#building-the-demo-installer" title="Permalink to this headline">¶</a></h2>
<p>To compile the demo installer, first change directories to
<code class="docutils literal"><span class="pre">build-config</span></code> and then type <code class="docutils literal"><span class="pre">make</span> <span class="pre">MACHINEROOT=../machine/&lt;vendor&gt;</span>
<span class="pre">MACHINE=&lt;platform&gt;</span> <span class="pre">demo</span></code>, specifying the target machine.  For
example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd build-config
$ make -j4 MACHINEROOT=../machine/&lt;vendor&gt; MACHINE=&lt;platform&gt; demo
</pre></div>
</div>
<p>When compilation finishes, the demo installer is located in
<code class="docutils literal"><span class="pre">build/images/demo-installer-&lt;platform&gt;.bin</span></code>.</p>
</div>
<div class="section" id="using-the-installer-with-onie">
<h2>Using the Installer with ONIE<a class="headerlink" href="#using-the-installer-with-onie" title="Permalink to this headline">¶</a></h2>
<p>The installer needs to be located where the ONIE discovery mechanisms
can find it.  See <a class="reference internal" href="../user-guide/index.html#user-guide"><span>User Guide</span></a> for more on the discovery
mechanisms and usage models.</p>
<p>For a quick lab demo, the IPv6 neighbor discovery method is described
next.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The build host and network switch must be on the same network
for this to work.  For example, the switch's Ethernet management port
and the build host should be on the same IP subnet.  Directly
attaching the build host to the network switch also works.</p>
</div>
<div class="section" id="installing-and-setting-up-an-http-server-on-your-build-host">
<h3>Installing and Setting Up an HTTP Server on Your Build Host<a class="headerlink" href="#installing-and-setting-up-an-http-server-on-your-build-host" title="Permalink to this headline">¶</a></h3>
<p>Assume the root of the HTTP server is <code class="docutils literal"><span class="pre">/var/www</span></code>.</p>
<p>Copy the demo installer to the HTTP server root, using the name
<code class="docutils literal"><span class="pre">onie-installer-&lt;platform&gt;-&lt;arch&gt;</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cp build/images/demo-installer-&lt;platform&gt;.bin /var/www/onie-installer-&lt;platform&gt;-&lt;arch&gt;
</pre></div>
</div>
<p>Currently the only supported <code class="docutils literal"><span class="pre">&lt;arch&gt;</span></code> are <code class="docutils literal"><span class="pre">x86_64</span></code>, <code class="docutils literal"><span class="pre">powerpc</span></code>,
<code class="docutils literal"><span class="pre">armv8</span></code> and <code class="docutils literal"><span class="pre">armv7</span></code>.</p>
</div>
<div class="section" id="powering-on-the-network-switch">
<h3>Powering on the Network Switch<a class="headerlink" href="#powering-on-the-network-switch" title="Permalink to this headline">¶</a></h3>
<p>When the switch powers up, ONIE will run and attempt to find an installer.
One of the methods is to look for a file named
<code class="docutils literal"><span class="pre">onie-installer-&lt;platform&gt;-&lt;arch&gt;</span></code> on all of the switch's IPv6 neighbors.</p>
<p>Using the NXP P2020RDB-PCA reference platform as an example, the
default installer name would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">nxp_p2020rdbpca</span><span class="o">-</span><span class="n">powerpc</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Connect to the serial console of the network switch.</li>
<li>Power cycle the machine.</li>
</ol>
<p>The serial console output should now look like:</p>
<div class="highlight-python"><div class="highlight"><pre>U-Boot 2013.01.01-g65a5657 (May 09 2013 - 10:43:49)

CPU0:  P2020E, Version: 2.1, (0x80ea0021)
Core:  E500, Version: 5.1, (0x80211051)
Clock Configuration:
       CPU0:1000.050 MHz, CPU1:1000.050 MHz,
...
Loading Open Network Install Environment ...
Version: 0.0.1-429376a-20130509-NB
...
</pre></div>
</div>
<p>ONIE will find the demo installer and run it.  After that, the machine
will reboot into the demo OS.</p>
</div>
</div>
<div class="section" id="demo-network-operating-system">
<h2>Demo Network Operating System<a class="headerlink" href="#demo-network-operating-system" title="Permalink to this headline">¶</a></h2>
<p>After the install, the system will reboot and you should see something
like:</p>
<div class="highlight-python"><div class="highlight"><pre>Welcome to the &lt;platform&gt; platform.

Please press Enter to activate this console.
</pre></div>
</div>
<p>Press the Enter key to get a root prompt on the machine.  You should see
something like:</p>
<div class="highlight-python"><div class="highlight"><pre>Welcome to the xyz_123 platform.
PLATFORM-OS:/ #
</pre></div>
</div>
<p>The example OS is running BusyBox, so feel free to look around.</p>
<div class="section" id="re-installing-or-installing-a-different-os">
<span id="demo-nos-reinstall"></span><h3>Re-installing or Installing a Different OS<a class="headerlink" href="#re-installing-or-installing-a-different-os" title="Permalink to this headline">¶</a></h3>
<p>If you want to install a new operating system, you can re-run the ONIE
installation process.  The demo NOS has a command to do just that:</p>
<div class="highlight-python"><div class="highlight"><pre>PLATFORM-OS:/ # install
</pre></div>
</div>
<p>This command will reboot the machine and the ONIE install process will
run again.  You would do this, for example, when you want to change
operating systems.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a destructive operation.</p>
</div>
</div>
<div class="section" id="uninstalling-to-wipe-the-machine-clean">
<span id="demo-nos-uninstall"></span><h3>Uninstalling to Wipe the Machine Clean<a class="headerlink" href="#uninstalling-to-wipe-the-machine-clean" title="Permalink to this headline">¶</a></h3>
<p>If you want to wipe the machine clean, removing all of the operating
system, use the <code class="docutils literal"><span class="pre">uninstall</span></code> command:</p>
<div class="highlight-python"><div class="highlight"><pre>PLATFORM-OS:/ # uninstall
</pre></div>
</div>
<p>This command will reboot the machine and ONIE will erase the available
NOR flash and mass storage devices.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a destructive operation.</p>
</div>
</div>
<div class="section" id="rescue-boot">
<span id="demo-nos-rescue"></span><h3>Rescue Boot<a class="headerlink" href="#rescue-boot" title="Permalink to this headline">¶</a></h3>
<p>ONIE has a rescue boot mode, where you can boot into the ONIE
environment and troubleshoot. The discovery and installer mechanisms
do not run while in rescue mode:</p>
<div class="highlight-python"><div class="highlight"><pre>PLATFORM-OS:/ # rescue
</pre></div>
</div>
<p>This command will reboot the machine and ONIE will enter rescue mode.</p>
</div>
<div class="section" id="updating-onie">
<span id="demo-nos-update"></span><h3>Updating ONIE<a class="headerlink" href="#updating-onie" title="Permalink to this headline">¶</a></h3>
<p>If you want to upgrade the ONIE version on the system, use the
<code class="docutils literal"><span class="pre">update</span></code> command.  This will restart the machine in ONIE update
mode:</p>
<div class="highlight-python"><div class="highlight"><pre>PLATFORM-OS:/ # update
</pre></div>
</div>
<p>See <a class="reference internal" href="../design-spec/updater.html#updating-onie"><span>Updating ONIE</span></a> for more details on this mode.</p>
</div>
</div>
<div class="section" id="demo-source-code-layout">
<h2>Demo Source Code Layout<a class="headerlink" href="#demo-source-code-layout" title="Permalink to this headline">¶</a></h2>
<p>The demo installer and OS source code is laid out as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>onie/demo
├── installer
│   ├── install.sh
│   └── sharch_body.sh
└── os
    ├── default
    │   ├── bin
    │   │   ├── install
    │   │   ├── rescue
    │   │   ├── uninstall
    │   │   └── update
    │   └── etc
    │       ├── init.d
    │       │   └── demo.sh
    │       ├── profile
    │       └── rc3.d
    │           └── S99demo.sh -&gt; ../init.d/demo.sh
    ├── grub-arch
    └── u-boot-arch
</pre></div>
</div>
<table class="table table-bordered">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Directory</th>
<th class="head">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>installer</td>
<td>Files used for making the installer.</td>
</tr>
<tr class="row-odd"><td>os/default</td>
<td>Files copied into the final sysroot image.</td>
</tr>
<tr class="row-even"><td>os/grub-arch</td>
<td>Files specific to GRUB based platforms.</td>
</tr>
<tr class="row-odd"><td>os/u-boot-arch</td>
<td>Files specific to U-Boot based platforms.</td>
</tr>
</tbody>
</table>
<p>A machine-specific configuration file is also required:</p>
<div class="highlight-python"><div class="highlight"><pre>machine/&lt;vendor&gt;/&lt;vendor&gt;_&lt;model&gt;/demo/platform.conf
</pre></div>
</div>
<p>This contains instructions specific to the machine needed by the
installer.</p>
<p>To understand how the self-extracting installer image is generated see
these source files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">build</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">make</span><span class="o">/</span><span class="n">demo</span><span class="o">.</span><span class="n">make</span>
<span class="n">build</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">mkdemo</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="porting.html" title="previous chapter (use the left arrow)">Porting Guide</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="demo_diag.html" title="next chapter (use the right arrow)">Demo Diagnostic OS Installer</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="demo_diag.html" title="Demo Diagnostic OS Installer"
             >next</a> |</li>
        <li class="right" >
          <a href="porting.html" title="Porting Guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Open Network Install Environment  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >For Developers</a> &raquo;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
        &copy; Copyright 2013-2017, <a href="https://cumulusnetworks.com/">Cumulus Networks, Inc.</a>  All Rights Reserved.
  </div>
  </body>
</html>