
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Network Operating System Interface &mdash; Open Network Install Environment 2014.02 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2014.02',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-45248701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Open Network Install Environment 2014.02 documentation" href="../index.html" />
    <link rel="up" title="Design Specification" href="index.html" />
    <link rel="next" title="Updating ONIE" href="updater.html" />
    <link rel="prev" title="Image Discovery and Execution" href="discovery.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="updater.html" title="Updating ONIE"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="discovery.html" title="Image Discovery and Execution"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Open Network Install Environment 2014.02 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Design Specification</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="network-operating-system-interface">
<span id="nos-interface"></span><h1>Network Operating System Interface<a class="headerlink" href="#network-operating-system-interface" title="Permalink to this headline">¶</a></h1>
<p>ONIE provides an environment for a network operating system (NOS) to perform
system provisioning and maintainance operations, including:</p>
<ul class="simple">
<li>Installing the NOS into the hardware</li>
<li>Reinstalling a different NOS</li>
<li>Uninstalling, or wiping the system clean</li>
<li>Rescue and recovery</li>
<li>Updating ONIE</li>
</ul>
<p>This environment forms an interface between ONIE and the NOS.</p>
<p>ONIE communicates with the NOS via U-Boot environment variables.  Both ONIE
and the NOS must be able to read and write U-Boot environment variables.</p>
<div class="section" id="nos-installer">
<h2>NOS Installer<a class="headerlink" href="#nos-installer" title="Permalink to this headline">¶</a></h2>
<p>The only requirement ONIE has for the NOS is that the NOS <strong>must</strong> update the
<tt class="docutils literal"><span class="pre">nos_bootcmd</span></tt> U-Boot environment variable described in
<a class="reference internal" href="boot_loader.html#platform-ind-vars"><em>Platform-Independent Environment Variables</em></a>. This signal tells U-Boot to load the NOS on
subsequent boots, bypassing ONIE.</p>
<p>What goes into the <tt class="docutils literal"><span class="pre">nos_bootcmd</span></tt> is entirely up to the NOS vendor, but
generally it will contain commands to load and boot the NOS image from
NOR flash or from an SD card.</p>
<p>Other than that, the NOS installer will do whatever is necessary
to persistently install the operating system into the hardware; the
installer has a lot of flexibility.</p>
<p>Some examples of what an installer could do:</p>
<ul class="simple">
<li>Fetch additional binaries and configuration files via HTTP</li>
<li>Chat with inventory control systems via HTTP</li>
<li>Download a new kernel+initramfs and <a class="reference external" href="http://linux.die.net/man/8/kexec">kexec(8)</a> into it</li>
</ul>
</div>
<div class="section" id="reinstalling-or-installing-a-different-nos">
<h2>Reinstalling or Installing a Different NOS<a class="headerlink" href="#reinstalling-or-installing-a-different-nos" title="Permalink to this headline">¶</a></h2>
<p>From the running NOS, it is possible to instruct ONIE to return to the
initial discovery and installation phase.  This could be used to
reinstall the current NOS or to install a different NOS.</p>
<p>To invoke the install operation, the running NOS sets the
<tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> U-Boot environment variable to the value
<tt class="docutils literal"><span class="pre">install</span></tt> (see <a class="reference internal" href="boot_loader.html#platform-ind-vars"><em>Platform-Independent Environment Variables</em></a>), and then reboots the
system.  When the system starts up again, ONIE will see the
<tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> and restart the discovery and installation phase.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt, you can also boot ONIE into the discovery and
installation phase by typing:</p>
<div class="last highlight-python"><pre>=&gt; run onie_bootcmd</pre>
</div>
</div>
</div>
<div class="section" id="uninstalling">
<h2>Uninstalling<a class="headerlink" href="#uninstalling" title="Permalink to this headline">¶</a></h2>
<p>ONIE has an uninstall operation that wipes out the unused portions of
NOR flash and the attached mass storage device (like an SD card or USB NAND
flash). The only thing untouched is ONIE itself. This is a
&#8220;reset to factory defaults&#8221;-like operation.</p>
<p>To invoke the uninstall operation, the running NOS sets the
<tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> U-Boot environment variable to the value
<tt class="docutils literal"><span class="pre">uninstall</span></tt> (see <a class="reference internal" href="boot_loader.html#platform-ind-vars"><em>Platform-Independent Environment Variables</em></a>), and then reboots the
system.  When the system starts up again ONIE, will see the
<tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> and start the uninstall process.</p>
<p>Following the uninstall process, the system returns to the
discovery and installation phase.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt you can also boot ONIE into the uninstall
mode by typing:</p>
<div class="last highlight-python"><pre>=&gt; run onie_uninstall</pre>
</div>
</div>
</div>
<div class="section" id="rescue-and-recovery">
<span id="rescue-recovery"></span><h2>Rescue and Recovery<a class="headerlink" href="#rescue-and-recovery" title="Permalink to this headline">¶</a></h2>
<p>ONIE provides a rescue and recovery mode, which is useful mostly during
development, but is potentially useful when trying to recover a broken
system.</p>
<p>The rescue mode is the same as the discovery and installation phase,
but the discovery mechanism is disabled.  ONIE does <strong>not</strong> try to
locate and install an image; it simply sits there allowing you to
troubleshoot the system.</p>
<p>In this mode you can connect to ONIE via the serial console or via
telnet.  You can use the available BusyBox tools to try and fix a
problem.  Or use <a class="reference external" href="http://linux.die.net/man/1/wget">wget</a> to download
more tools and files.</p>
<p>A few useful commands included with ONIE are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">onie-nos-install</span></tt> &#8211; It takes one argument, a URL to a NOS installer.  This
command downloads and installs from the URL, just as if it had been
<em>discovered</em>.</li>
<li><tt class="docutils literal"><span class="pre">onie-self-update</span></tt> &#8211; It takes one argument, a URL to an ONIE updater.  This
command downloads and runs the updater, just as if it had been
<em>discovered</em>.  See the <a class="reference internal" href="updater.html#updating-onie"><em>Updating ONIE</em></a> section for more about
updating ONIE.</li>
<li><tt class="docutils literal"><span class="pre">onie-discovery-stop</span></tt> &#8211; Stop the discovery process.  This can be
useful in debugging cases where the discovery process is interfering
with the debug.  With the discovery process disabled the system is
quiet and you can poke around.</li>
</ul>
<p>To invoke the rescue operation, the running NOS sets the <tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt>
U-Boot environment variable to the value <tt class="docutils literal"><span class="pre">rescue</span></tt>
(see <a class="reference internal" href="boot_loader.html#platform-ind-vars"><em>Platform-Independent Environment Variables</em></a>), and then reboots the system.  When the system
starts up again, ONIE will see the <tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> and enter rescue mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt you can also boot ONIE into rescue mode by
typing:</p>
<div class="last highlight-python"><pre>=&gt; run onie_rescue</pre>
</div>
</div>
</div>
<div class="section" id="updating-onie">
<span id="nos-intf-updating-onie"></span><h2>Updating ONIE<a class="headerlink" href="#updating-onie" title="Permalink to this headline">¶</a></h2>
<p>ONIE provides a way to update itself, including the boot loader and
Linux kernel.  In many ways, this behaves similarly to the discovery
and installation phase, except that ONIE is looking for a different
kind of image.</p>
<p>See the <a class="reference internal" href="updater.html#updating-onie"><em>Updating ONIE</em></a> section for more about updating ONIE.</p>
<p>To invoke the ONIE update operation, the running NOS sets the
<tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> U-Boot environment variable to the value
<tt class="docutils literal"><span class="pre">update</span></tt> (see <a class="reference internal" href="boot_loader.html#platform-ind-vars"><em>Platform-Independent Environment Variables</em></a>), and then reboots the
system.  When the system starts up again, ONIE will see the
<tt class="docutils literal"><span class="pre">onie_boot_reason</span></tt> and enter ONIE self-update mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>From the U-Boot prompt you can also boot ONIE into ONIE self-update mode by
typing:</p>
<div class="last highlight-python"><pre>=&gt; run onie_update</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/ONIE-logo-green-160x60.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Network Operating System Interface</a><ul>
<li><a class="reference internal" href="#nos-installer">NOS Installer</a></li>
<li><a class="reference internal" href="#reinstalling-or-installing-a-different-nos">Reinstalling or Installing a Different NOS</a></li>
<li><a class="reference internal" href="#uninstalling">Uninstalling</a></li>
<li><a class="reference internal" href="#rescue-and-recovery">Rescue and Recovery</a></li>
<li><a class="reference internal" href="#updating-onie">Updating ONIE</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="discovery.html"
                        title="previous chapter">Image Discovery and Execution</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="updater.html"
                        title="next chapter">Updating ONIE</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/design-spec/nos_interface.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="updater.html" title="Updating ONIE"
             >next</a> |</li>
        <li class="right" >
          <a href="discovery.html" title="Image Discovery and Execution"
             >previous</a> |</li>
        <li><a href="../index.html">Open Network Install Environment 2014.02 documentation</a> &raquo;</li>
          <li><a href="index.html" >Design Specification</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright .
    </div>
  </body>
</html>