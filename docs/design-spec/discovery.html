
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Image Discovery and Execution &mdash; Open Network Install Environment 2014.08 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2014.08',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-45248701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Open Network Install Environment 2014.08 documentation" href="../index.html" />
    <link rel="up" title="Operating Software Design" href="operating_sw_design.html" />
    <link rel="next" title="Network Operating System Interface" href="nos_interface.html" />
    <link rel="prev" title="Linux Kernel Configuration" href="kernel.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="nos_interface.html" title="Network Operating System Interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="kernel.html" title="Linux Kernel Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Open Network Install Environment 2014.08 documentation</a> &raquo;</li>
          <li><a href="index.html" >Design Specification</a> &raquo;</li>
          <li><a href="operating_sw_design.html" accesskey="U">Operating Software Design</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="image-discovery-and-execution">
<h1>Image Discovery and Execution<a class="headerlink" href="#image-discovery-and-execution" title="Permalink to this headline">¶</a></h1>
<p>The primary responsibility of ONIE is to locate a network operating system
(NOS) installer and execute it.</p>
<div class="section" id="platform-name-and-identification">
<span id="platform-name"></span><h2>Platform Name and Identification<a class="headerlink" href="#platform-name-and-identification" title="Permalink to this headline">¶</a></h2>
<p>For identifying the running platform. ONIE uses the following definitions:</p>
<ul class="simple">
<li>arch &#8211; The CPU architecture.  The currently supported architectures are:<ul>
<li>powerpc</li>
<li>x86_64</li>
</ul>
</li>
<li>machine &#8211; A string of the form <tt class="docutils literal"><span class="pre">&lt;VENDOR&gt;_&lt;MODEL&gt;</span></tt>.</li>
<li>machine-revision &#8211; A string of the form <tt class="docutils literal"><span class="pre">r&lt;NUMBER&gt;</span></tt>, used to track
different hardware revision of a machine</li>
<li>platform &#8211; A string of the form <tt class="docutils literal"><span class="pre">&lt;ARCH&gt;-&lt;MACHINE&gt;-&lt;MACHINE-REVISION&gt;</span></tt></li>
</ul>
<p>At runtime, ONIE provides the <tt class="docutils literal"><span class="pre">onie-sysinfo</span></tt> command, which can be
used to dump this information and more.  See the
<a class="reference internal" href="nos_interface.html#cmd-onie-sysinfo"><em>System Information</em></a> section for more about the <tt class="docutils literal"><span class="pre">onie-sysinfo</span></tt>
command.</p>
</div>
<div class="section" id="installer-discovery-methods">
<span id="installer-discovery"></span><h2>Installer Discovery Methods<a class="headerlink" href="#installer-discovery-methods" title="Permalink to this headline">¶</a></h2>
<p>ONIE attempts to locate the installer through a number of discovery
methods.  The first successful method found is used to download and
run an installer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though an installer is successfully found, the
installer can fail, in which case ONIE moves on to the next discovery
method.</p>
</div>
<p>The following methods are tried in this order:</p>
<ol class="arabic simple">
<li>Statically configured (passed from boot loader)</li>
<li>Local file systems (USB for example)</li>
<li>Exact URLs from DHCPv4</li>
<li>Inexact URLs based on DHCP responses</li>
<li>IPv6 neighbors</li>
<li>TFTP waterfall</li>
</ol>
<p>The subsequent sections describe these methods in detail.</p>
<div class="section" id="default-file-name-search-order">
<span id="default-file-name"></span><h3>Default File Name Search Order<a class="headerlink" href="#default-file-name-search-order" title="Permalink to this headline">¶</a></h3>
<p>In a number of the following methods, ONIE searches for default file
names in a specific order.  All the methods use the same default file
names and search order, which are described in this section.</p>
<p>The default installer file names are searched for in the following order:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;-r&lt;machine_revision&gt;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">onie-installer-&lt;vendor&gt;_&lt;machine&gt;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">onie-installer-&lt;arch&gt;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">onie-installer</span></tt></li>
</ol>
<p>For a hypothetical x86_64 machine, the default installer file names
would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span><span class="o">-</span><span class="n">r0</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">VENDOR_MACHINE</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">onie</span><span class="o">-</span><span class="n">installer</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the case of ONIE <em>self-update mode</em>, the file name prefix is
<tt class="docutils literal"><span class="pre">onie-updater</span></tt> instead of <tt class="docutils literal"><span class="pre">onie-installer</span></tt>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the exact file names used for your specific hardware
platform please contact your NOS vendor or your hardware
vendor.</p>
</div>
</div>
<div class="section" id="static-configuration-method">
<h3>Static Configuration Method<a class="headerlink" href="#static-configuration-method" title="Permalink to this headline">¶</a></h3>
<p>This method is intended for engineering use only; for example, during
the porting of ONIE to a new platform.  In the boot loader, the user
can statically configure an installer URL that ONIE will use by
setting the <tt class="docutils literal"><span class="pre">install_url</span></tt> kernel command line argument.</p>
</div>
<div class="section" id="local-file-system-method">
<h3>Local File System Method<a class="headerlink" href="#local-file-system-method" title="Permalink to this headline">¶</a></h3>
<p>In this method, ONIE searches the partitions of locally attached
storage devices looking for one of the ONIE default installer file
names.</p>
<p>See <a class="reference internal" href="#default-file-name"><em>Default File Name Search Order</em></a> for more information on the default file names.</p>
<p>This method is intended for the case where the NOS installer is
available on a USB memory stick plugged into the front panel.</p>
<p>The supported Linux file system types for the local storage are
<tt class="docutils literal"><span class="pre">vfat</span></tt> (common on commercially availabe USB sticks) and <tt class="docutils literal"><span class="pre">ext2</span></tt>.</p>
<p>The general algorithm for locating the installer on local storage
proceeds as follows:</p>
<div class="highlight-python"><pre>foreach $partition in /proc/partitions {
  if able to mount $partition then {
    if default file name exists {
      Add partition to found_list
    }
  }
}

foreach $partition in found_list {
  Run installer from $partition
}</pre>
</div>
</div>
<div class="section" id="dhcp-requests-and-responses">
<span id="onie-dhcp-requests"></span><h3>DHCP Requests and Responses<a class="headerlink" href="#dhcp-requests-and-responses" title="Permalink to this headline">¶</a></h3>
<p>DHCP provides a powerful and flexible mechanism for specifying the
installer URL exactly.  During the DHCP request, ONIE sets a number of
options to help the DHCP server determine an appropriate response.</p>
<p>The following options are set during the request:</p>
<table border="1" class="docutils">
<caption>DHCP Request Options</caption>
<colgroup>
<col width="13%" />
<col width="38%" />
<col width="38%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Name</th>
<th class="head">ISC option-name</th>
<th class="head">RFC</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>60</td>
<td>Vendor Class Identifier</td>
<td>vendor-class-identifier</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">RFC 2132</a></td>
</tr>
<tr class="row-odd"><td>77</td>
<td>User Class</td>
<td>user-class</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">RFC 2132</a></td>
</tr>
<tr class="row-even"><td>125</td>
<td>Vendor-Identifying Vendor-Specific Information</td>
<td>vivso</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc3925.txt">RFC 3925</a></td>
</tr>
<tr class="row-odd"><td>55</td>
<td>Parameter Request List</td>
<td>dhcp-parameter-request-list</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">RFC 2132</a></td>
</tr>
</tbody>
</table>
<div class="section" id="vendor-class-identifier-option-60">
<span id="onie-dhcp-vendor-class"></span><h4>Vendor Class Identifier &#8211; Option 60<a class="headerlink" href="#vendor-class-identifier-option-60" title="Permalink to this headline">¶</a></h4>
<p>The vendor class identifier option is the concatenation of two
strings, separated by the colon <tt class="docutils literal"><span class="pre">:</span></tt> character:</p>
<ol class="arabic simple">
<li>The static string <tt class="docutils literal"><span class="pre">onie_vendor</span></tt></li>
<li>&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;-r&lt;machine_revision&gt;</li>
</ol>
<p>For example, using the example x86_64 machine, the string would be:</p>
<div class="highlight-python"><pre>onie_vendor:x86_64-VENDOR_MACHINE-r0</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the exact DHCP Vendor Class Identifier used for your
specific hardware platform please contact your NOS vendor or
your hardware vendor.</p>
</div>
<p>See the <a class="reference internal" href="#platform-name"><em>Platform Name and Identification</em></a> table for more about the platform name.</p>
</div>
<div class="section" id="user-class-option-77">
<h4>User Class &#8211; Option 77<a class="headerlink" href="#user-class-option-77" title="Permalink to this headline">¶</a></h4>
<p>The user class option is set to the static string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">onie_dhcp_user_class</span>
</pre></div>
</div>
</div>
<div class="section" id="vendor-identifying-vendor-specific-information-vivso">
<span id="dhcp-vivso"></span><h4>Vendor-Identifying Vendor-Specific Information (VIVSO)<a class="headerlink" href="#vendor-identifying-vendor-specific-information-vivso" title="Permalink to this headline">¶</a></h4>
<p>The VIVSO option allows for custom option namespaces, where the
namespace is identified by the <a class="reference external" href="http://www.iana.org/assignments/enterprise-numbers">32-bit IANA Private Enterprise Number</a>.  ONIE
currently uses the enterprise number <tt class="docutils literal"><span class="pre">42623</span></tt> to identify its custom
namespace.</p>
<p>The option codes within the ONIE namespace have a size of 1 byte. The
option payload length is also 1 byte.</p>
<p>Within this namespace, the following option codes are defined:</p>
<table border="1" class="docutils" id="dhcp-vendor-options">
<caption>VIVSO Options</caption>
<colgroup>
<col width="17%" />
<col width="33%" />
<col width="17%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Code</th>
<th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Installer URL</td>
<td>string</td>
<td>http://10.0.1.205/nos_installer.bin</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Updater URL</td>
<td>string</td>
<td>http://10.0.1.205/onie_update.bin</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Platform Name</td>
<td>string</td>
<td>VENDOR_MACHINE</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>CPU Architecture</td>
<td>string</td>
<td>x86_64</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Machine Revision</td>
<td>string</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>See the <a class="reference internal" href="powerpc_boot_loader.html#u-boot-platform-vars"><em>Platform-Dependent Environment Variables</em></a> table for more information about the platform
name.</p>
</div>
<div class="section" id="parameter-request-list-option-55">
<h4>Parameter Request List &#8211; Option 55<a class="headerlink" href="#parameter-request-list-option-55" title="Permalink to this headline">¶</a></h4>
<p>The parameter request list option encodes a list of requested options.
ONIE requests the following options:</p>
<table border="1" class="docutils">
<caption>DHCP Parameter Request List Options</caption>
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="22%" />
<col width="11%" />
<col width="11%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Name</th>
<th class="head">ISC option-name</th>
<th class="head">Option Type</th>
<th class="head">RFC</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Subnet Mask</td>
<td>subnet-mask</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>255.255.255.0</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Default Gateway</td>
<td>routers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-even"><td>6</td>
<td>Domain Server</td>
<td>domain-name-servers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>Log Server</td>
<td>log-servers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-even"><td>12</td>
<td>Hostname</td>
<td>host-name</td>
<td>&nbsp;</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>switch-19</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>Domain Name</td>
<td>domain-name</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>cumulusnetworks.com</td>
</tr>
<tr class="row-even"><td>42</td>
<td>NTP Servers</td>
<td>ntp-servers</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-odd"><td>54</td>
<td>DHCP Server Identifier</td>
<td>dhcp-server-identifier</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.2</td>
</tr>
<tr class="row-even"><td>66</td>
<td>TFTP Server Name</td>
<td>tftp-server-name</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>behemoth01 (requires DNS)</td>
</tr>
<tr class="row-odd"><td>67</td>
<td>TFTP Bootfile Name</td>
<td>bootfile-name or filename</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>tftp/installer.sh</td>
</tr>
<tr class="row-even"><td>72</td>
<td>HTTP Server IP</td>
<td>www-server</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc2132.txt">2132</a></td>
<td>10.0.1.251</td>
</tr>
<tr class="row-odd"><td>114</td>
<td>Default URL</td>
<td>default-url</td>
<td>string</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc3679.txt">3679</a></td>
<td>http://server/path/installer</td>
</tr>
<tr class="row-even"><td>150</td>
<td>TFTP Server IP Address</td>
<td>next-server</td>
<td>dotted quad</td>
<td><a class="reference external" href="http://www.ietf.org/rfc/rfc5859.txt">5859</a></td>
<td>10.50.1.200</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="http-requests-and-http-headers">
<span id="http-headers"></span><h3>HTTP Requests and HTTP Headers<a class="headerlink" href="#http-requests-and-http-headers" title="Permalink to this headline">¶</a></h3>
<p>All HTTP requests made by ONIE include a set of standard HTTP headers,
which an HTTP CGI automation system could utilize.  The headers sent on
each HTTP request are:</p>
<table border="1" class="docutils">
<caption>HTTP Headers</caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header</th>
<th class="head">Value</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ONIE-SERIAL-NUMBER:</td>
<td>Serial number</td>
<td>XYZ123004</td>
</tr>
<tr class="row-odd"><td>ONIE-ETH-ADDR:</td>
<td>Management MAC address</td>
<td>08:9e:01:62:d1:93</td>
</tr>
<tr class="row-even"><td>ONIE-VENDOR-ID:</td>
<td>32-bit IANA Private Enterprise Number in decimal</td>
<td>12345</td>
</tr>
<tr class="row-odd"><td>ONIE-MACHINE:</td>
<td>&lt;vendor&gt;_&lt;machine&gt;</td>
<td>VENDOR_MACHINE</td>
</tr>
<tr class="row-even"><td>ONIE-MACHINE-REV:</td>
<td>&lt;machine_revision&gt;</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>ONIE-ARCH:</td>
<td>CPU architecture</td>
<td>x86_64</td>
</tr>
<tr class="row-even"><td>ONIE-SECURITY-KEY:</td>
<td>Security key</td>
<td>d3b07384d-ac-6238ad5ff00</td>
</tr>
<tr class="row-odd"><td>ONIE-OPERATION:</td>
<td>ONIE mode of operation</td>
<td><tt class="docutils literal"><span class="pre">os-install</span></tt> or <tt class="docutils literal"><span class="pre">onie-update</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="exact-installer-urls-from-dhcpv4">
<h3>Exact Installer URLs From DHCPv4<a class="headerlink" href="#exact-installer-urls-from-dhcpv4" title="Permalink to this headline">¶</a></h3>
<p>The DHCP options discussed previously provide a number of ways to
express the <strong>exact</strong> URL of the NOS installer.  When interpreting URLs,
ONIE accepts the following URI schemes:</p>
<ul class="simple">
<li>http://server/path/....</li>
<li>https://server/path/....</li>
<li>ftp://server/path/....</li>
<li>tftp://server/path/....</li>
</ul>
<p>The following options can be used to form an exact URL.</p>
<table border="1" class="docutils">
<caption>Exact DHCP URLs</caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Name</th>
<th class="head">Comments</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>125</td>
<td>VIVSO</td>
<td>The <em>installer URL</em> option (code = 1) specified in the ONIE VIVSO. Options yields an exact URL.  See <a class="reference internal" href="#dhcp-vivso"><em>Vendor-Identifying Vendor-Specific Information (VIVSO)</em></a> above.</td>
</tr>
<tr class="row-odd"><td>114</td>
<td>Default URL</td>
<td>Intended for HTTP, but other URLs accepted.</td>
</tr>
<tr class="row-even"><td>150 + 67</td>
<td>TFTP server IP and TFTP bootfile</td>
<td>Both options required for an exact URL.</td>
</tr>
<tr class="row-odd"><td>66 + 67</td>
<td>TFTP server name and TFTP bootfile</td>
<td>Both options required for an exact URL.  Requires DNS.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="partial-installer-urls">
<h3>Partial Installer URLs<a class="headerlink" href="#partial-installer-urls" title="Permalink to this headline">¶</a></h3>
<p>Configuring a DHCP server for exact URLs may be impractical in certain
situations.</p>
<p>For example, consider an enterprise scenario where the corporate IT
department that controls the DHCP server is separate from the
application development department trying to prototype new Web
services.  The application department wants to move quickly and
prototype their new solution as soon as possible.  In this case,
waiting for the IT department to make DHCP server changes takes too much time.</p>
<p>To allow for flexibility in the administration of the DHCP server, ONIE
can find an installer using partial DHCP information.  ONIE uses a
default sequence of URL paths and default file names in conjunction
with partial DHCP information to find an installer.</p>
<p>See <a class="reference internal" href="#default-file-name"><em>Default File Name Search Order</em></a> for more information on the default file
names and search order.</p>
<p>The following DHCP option responses are used to locate an installer in
conjunction with the default file names:</p>
<table border="1" class="docutils">
<caption>Partial DHCP URLs</caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DHCP Options</th>
<th class="head">Name</th>
<th class="head">URL</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>67</td>
<td>TFTP Bootfile</td>
<td>Contents of bootfile <a class="footnote-reference" href="#bootfile-url" id="id16">[1]</a></td>
</tr>
<tr class="row-odd"><td>72</td>
<td>HTTP Server IP</td>
<td>http://$http_server_ip/${onie_default_installer_names}</td>
</tr>
<tr class="row-even"><td>66</td>
<td>TFTP Server IP</td>
<td>http://$tftp_server_ip/${onie_default_installer_names}</td>
</tr>
<tr class="row-odd"><td>66</td>
<td>DHCP Server IP</td>
<td>http://$dhcp_server_ip/${onie_default_installer_names}</td>
</tr>
</tbody>
</table>
<div class="section" id="tftp-waterfall">
<h4>TFTP Waterfall<a class="headerlink" href="#tftp-waterfall" title="Permalink to this headline">¶</a></h4>
<p>ONIE includes a classic PXE-like TFTP waterfall.  Given a TFTP
server address, ONIE attempts to download the installer using a
sequence of TFTP paths with decreasing levels of specificity.</p>
<p>The TFTP URL name has this format:</p>
<div class="highlight-python"><pre>tftp://$tftp_server_ip/$path_prefix/$onie_default_installer_name</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">$tftp_server_ip</span></tt> comes from DHCP option 66.</p>
<p>The <tt class="docutils literal"><span class="pre">$path_prefix</span></tt> is determined in the following manner:</p>
<ol class="arabic simple">
<li>First the <tt class="docutils literal"><span class="pre">path_prefix</span></tt> is built using the Ethernet management
interface&#8217;s MAC address using lower case hexadecimal with a dash
separator. For example, with address <tt class="docutils literal"><span class="pre">55:66:AA:BB:CC:DD</span></tt> the
<tt class="docutils literal"><span class="pre">path_prefix</span></tt> would be <tt class="docutils literal"><span class="pre">55-66-aa-bb-cc-dd</span></tt>.</li>
<li>Next, the <tt class="docutils literal"><span class="pre">path_prefix</span></tt> is built using the Ethernet management
interface&#8217;s IP address in upper case hexadecimal. For example,
<tt class="docutils literal"><span class="pre">192.168.1.178</span> <span class="pre">-&gt;</span> <span class="pre">C0A801B2</span></tt>.  If the installer is not found
at that location, remove the least significant hex digit and try again.</li>
<li>Finally, look for the list of default file names at the root of the TFTP server.</li>
</ol>
<p>Here is a complete list of the bootfile paths attempted using the
example MAC address, IP address and the example x86_64 platform:</p>
<div class="highlight-python"><pre>55-66-aa-bb-cc-dd/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0A801B2/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0A801B/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0A801/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0A80/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0A8/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0A/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C0/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
C/onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;-&lt;machine_revision&gt;
onie-installer-&lt;arch&gt;-&lt;vendor&gt;_&lt;machine&gt;
onie-installer-&lt;vendor&gt;_&lt;machine&gt;
onie-installer-&lt;arch&gt;
onie-installer</pre>
</div>
<p>See <a class="reference internal" href="#default-file-name"><em>Default File Name Search Order</em></a> for more information on the default file
names and search order.</p>
</div>
<div class="section" id="http-ipv6-neighbors">
<span id="discover-neighbors"></span><h4>HTTP IPv6 Neighbors<a class="headerlink" href="#http-ipv6-neighbors" title="Permalink to this headline">¶</a></h4>
<p>ONIE also queries its IPv6 link-local neighbors via HTTP for an
installer.  The general algorithm follows:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">ping6</span></tt> the &#8220;all nodes&#8221; link local IPv6 multicast address, <tt class="docutils literal"><span class="pre">ff02::1</span></tt>.</li>
<li>For each responding neighbor, try to download the default file names
from the root of the Web server.</li>
</ol>
<p>Here is an example the URLs used by this method:</p>
<div class="highlight-python"><pre>http://fe80::4638:39ff:fe00:139e%eth0/onie-installer-x86_64-VENDOR_MACHINE-r0
http://fe80::4638:39ff:fe00:139e%eth0/onie-installer-x86_64-VENDOR_MACHINE
http://fe80::4638:39ff:fe00:139e%eth0/onie-installer-VENDOR_MACHINE
http://fe80::4638:39ff:fe00:139e%eth0/onie-installer-x86_64
http://fe80::4638:39ff:fe00:139e%eth0/onie-installer
http://fe80::4638:39ff:fe00:2659%eth0/onie-installer-x86_64-VENDOR_MACHINE-r0
http://fe80::4638:39ff:fe00:2659%eth0/onie-installer-x86_64-VENDOR_MACHINE
http://fe80::4638:39ff:fe00:2659%eth0/onie-installer-VENDOR_MACHINE
http://fe80::4638:39ff:fe00:2659%eth0/onie-installer-x86_64
http://fe80::4638:39ff:fe00:2659%eth0/onie-installer
http://fe80::230:48ff:fe9f:1547%eth0/onie-installer-x86_64-VENDOR_MACHINE-r0
http://fe80::230:48ff:fe9f:1547%eth0/onie-installer-x86_64-VENDOR_MACHINE
http://fe80::230:48ff:fe9f:1547%eth0/onie-installer-VENDOR_MACHINE
http://fe80::230:48ff:fe9f:1547%eth0/onie-installer-x86_64
http://fe80::230:48ff:fe9f:1547%eth0/onie-installer</pre>
</div>
<p>This makes it very simple to walk up to a switch and directly connect
a laptop to the Ethernet management port and install from a local HTTP server.</p>
<p>See <a class="reference internal" href="#default-file-name"><em>Default File Name Search Order</em></a> for more information on the default file
names and search order.</p>
</div>
</div>
</div>
<div class="section" id="execution-environment">
<h2>Execution Environment<a class="headerlink" href="#execution-environment" title="Permalink to this headline">¶</a></h2>
<p>After ONIE locates and downloads an installer, the next step is to run
the installer.</p>
<p>Prior to execution, ONIE prepares an execution environment:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">chmod</span> <span class="pre">+x</span></tt> on the downloaded installer.</li>
<li>Export a number of environment variables, usable by the installer.</li>
<li>Run the installer.</li>
</ul>
<p>ONIE exports the following environment variables:</p>
<table border="1" class="docutils">
<caption>Installer Core Environment Variables</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable Name</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>onie_exec_url</td>
<td>Currently executing URL</td>
</tr>
<tr class="row-odd"><td>onie_platform</td>
<td>CPU architecture, vendor and machine name</td>
</tr>
<tr class="row-even"><td>onie_vendor_id</td>
<td>32-bit IANA Private Enterprise Number in decimal</td>
</tr>
<tr class="row-odd"><td>onie_serial_num</td>
<td>Device serial number</td>
</tr>
<tr class="row-even"><td>onie_eth_addr</td>
<td>MAC address for Ethernet management port</td>
</tr>
</tbody>
</table>
<p>In addition, any and all DHCP response options are exported, in the
style of BusyBox&#8217;s <tt class="docutils literal"><span class="pre">udhcpc</span></tt>.  A sample of those variables follows:</p>
<table border="1" class="docutils">
<caption>Installer DHCP Environment Variables</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable Name</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>onie_disco_dns</td>
<td>DNS Server</td>
</tr>
<tr class="row-odd"><td>onie_disco_domain</td>
<td>Domain name from DNS</td>
</tr>
<tr class="row-even"><td>onie_disco_hostname</td>
<td>Switch hostname</td>
</tr>
<tr class="row-odd"><td>onie_disco_interface</td>
<td>Ethernet management interface, like eth0</td>
</tr>
<tr class="row-even"><td>onie_disco_ip</td>
<td>Ethernet management IP address</td>
</tr>
<tr class="row-odd"><td>onie_disco_router</td>
<td>Gateway</td>
</tr>
<tr class="row-even"><td>onie_disco_serverid</td>
<td>DHCP server IP</td>
</tr>
<tr class="row-odd"><td>onie_disco_siaddr</td>
<td>TFTP server IP</td>
</tr>
<tr class="row-even"><td>onie_disco_subnet</td>
<td>IP netmask</td>
</tr>
<tr class="row-odd"><td>onie_disco_vivso</td>
<td>VIVSO option data</td>
</tr>
</tbody>
</table>
<p>See <a class="reference internal" href="nos_interface.html#nos-interface"><em>Network Operating System Interface</em></a> for more about the NOS installer.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="bootfile-url" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[1]</a></td><td>Try to intrepret the bootfile as a URL.  This is a
small abuse of the TFTP bootfile option, which has
a precedent in other loading schemes such as <a class="reference external" href="http://ipxe.org/howto/dhcpd">iPXE</a>.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/ONIE-logo-green-160x60.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Image Discovery and Execution</a><ul>
<li><a class="reference internal" href="#platform-name-and-identification">Platform Name and Identification</a></li>
<li><a class="reference internal" href="#installer-discovery-methods">Installer Discovery Methods</a><ul>
<li><a class="reference internal" href="#default-file-name-search-order">Default File Name Search Order</a></li>
<li><a class="reference internal" href="#static-configuration-method">Static Configuration Method</a></li>
<li><a class="reference internal" href="#local-file-system-method">Local File System Method</a></li>
<li><a class="reference internal" href="#dhcp-requests-and-responses">DHCP Requests and Responses</a><ul>
<li><a class="reference internal" href="#vendor-class-identifier-option-60">Vendor Class Identifier &#8211; Option 60</a></li>
<li><a class="reference internal" href="#user-class-option-77">User Class &#8211; Option 77</a></li>
<li><a class="reference internal" href="#vendor-identifying-vendor-specific-information-vivso">Vendor-Identifying Vendor-Specific Information (VIVSO)</a></li>
<li><a class="reference internal" href="#parameter-request-list-option-55">Parameter Request List &#8211; Option 55</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-requests-and-http-headers">HTTP Requests and HTTP Headers</a></li>
<li><a class="reference internal" href="#exact-installer-urls-from-dhcpv4">Exact Installer URLs From DHCPv4</a></li>
<li><a class="reference internal" href="#partial-installer-urls">Partial Installer URLs</a><ul>
<li><a class="reference internal" href="#tftp-waterfall">TFTP Waterfall</a></li>
<li><a class="reference internal" href="#http-ipv6-neighbors">HTTP IPv6 Neighbors</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#execution-environment">Execution Environment</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="kernel.html"
                        title="previous chapter">Linux Kernel Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="nos_interface.html"
                        title="next chapter">Network Operating System Interface</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/design-spec/discovery.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="nos_interface.html" title="Network Operating System Interface"
             >next</a> |</li>
        <li class="right" >
          <a href="kernel.html" title="Linux Kernel Configuration"
             >previous</a> |</li>
        <li><a href="../index.html">Open Network Install Environment 2014.08 documentation</a> &raquo;</li>
          <li><a href="index.html" >Design Specification</a> &raquo;</li>
          <li><a href="operating_sw_design.html" >Operating Software Design</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright .
    </div>
  </body>
</html>